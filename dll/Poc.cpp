// Poc.cpp : Defines the entry point for the DLL application.
#include <stdio.h>
#include <Lmcons.h>
#include <fstream>
#include <Windows.h>


BOOL APIENTRY DllMain(HMODULE hModule,
	DWORD  ul_reason_for_call,
	LPVOID lpReserved
)
{
	//Variables used for "CreateProcess". Uncomment if needed
	//STARTUPINFO startInfo = { 0 };
	//PROCESS_INFORMATION processInfo = { 0 };

	std::ofstream outdata;
	TCHAR username[UNLEN + 1];
	DWORD size = UNLEN + 1;
	GetUserName((TCHAR*)username, &size);

	switch (ul_reason_for_call)
	{
	case DLL_PROCESS_ATTACH:
		//Write to a file called whoami.txt, who the user is. 
		outdata.open("c:\\temp\\whoami.txt");
		if (outdata.is_open()) {
			outdata << username;
			outdata.close();
		}

		//It's also possible to create a new process. 
		//CreateProcess(TEXT("C:\\Windows\\cmd.exe"), NULL, NULL, NULL, FALSE, NULL, NULL, NULL, &startInfo, &processInfo);

	case DLL_THREAD_ATTACH:
	case DLL_THREAD_DETACH:
	case DLL_PROCESS_DETACH:
		break;
	}
	return TRUE;
}